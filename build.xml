<project>
    <property name="src.dir" value="client"/>
    <property name="build.dir" value="bin"/>
    <property name="lib.dir" value="libs"/>
    <property name="server.name" value="ec2-50-17-80-217.compute-1.amazonaws.com"/>
    <property name="server.path" value="/persistent/labdoo/sites/all/modules/"/>
	<property name="client.key" value="/home/carlos/Desktop/labdoo/labdoo-dev.pem"/>
	<property name="server.src_dir" value="xmlrpc-server"/>
    <path id="classpath">
        <fileset dir="${lib.dir}" includes="**/*.jar"/>
    </path>
    <target name="clean">
        <delete dir="${build.dir}"/>
    </target>
    <target name="compile">
        <mkdir dir="${build.dir}"/>
        <javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="classpath" />
    </target>
	<!-- these commands have dependencies from http://www.jcraft.com/jsch/ -->
	<target name="remote-clean">
		  <sshexec host="${server.name}"
			username="root"
			keyfile="${client.key}"
			command="rm -rf /tmp/xmlrpc-server.old; mv -f ${server.path}xmlrpc-server /tmp/xmlrpc-server.old; mkdir ${server.path}xmlrpc-server"/>		
	</target>
    <target name="remote-deploy" depends="remote-clean">
    	<!-- TODO to remove -->
    	<copy file="xmlrpc-server/xmlrpc.info.php" tofile="xmlrpc-server/xmlrpc.info"/>
    	<copy file="xmlrpc-server/xmlrpc.module.php" tofile="xmlrpc-server/xmlrpc.module"/>
    	  <scp todir="root@${server.name}:${server.path}xmlrpc-server" keyfile="${client.key}">
    	  	<fileset dir="${server.src_dir}" />
    	  	</scp>
		  <sshexec host="${server.name}"
			username="root"
			keyfile="${client.key}"
			command="/etc/init.d/httpd restart"/>
    </target>
	

</project>